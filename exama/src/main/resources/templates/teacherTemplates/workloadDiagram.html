<html lang="DE" xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head th:include="fragments/head :: head"></head>

<body>
    <div id="wrapper">
        <!-- header with navigation (only desktop and tablet), title and logout-button -->
        <div th:include="fragments/header :: header"></div>

        <div th:include="fragments/coursenavigation :: coursenavigation"></div>

        <!-- content displayed in the center of the window -->
        <div id="content-wrapper">
            <h1>Workloaddiagramm</h1>
            <a th:with="urlBuilder=${T(org.springframework.web.servlet.support.ServletUriComponentsBuilder).fromCurrentRequest()}"
                th:href="${urlBuilder.replaceQueryParam('view', '2').toUriString()}">> Wochenansicht (alle
                Assignments)</a><br><br>
            <a th:href="@{/calendarchoose?view=3&coreCourse={cc}(cc=${coreCourse.id})}">> Semesteransicht</a><br><br>
            <!-- @ Roman: vielleicht wäre es cool, wenn die Seite auch auf calendar&view=3... gemappt würde. aber besprechen wir noch, wo was hin kommt :-) -->

            <h2>Klasse [[${coreCourse.name}]]</h2>
            <h3>Woche vom Montag, [[${#temporals.format(monday, 'dd.MM.yyyy')}]]</h3>
            <a th:with="urlBuilder=${T(org.springframework.web.servlet.support.ServletUriComponentsBuilder).fromCurrentRequest()}"
                th:href="${urlBuilder.replaceQueryParam('monday', #temporals.format(#temporals.createNow(), 'yyyy-MM-dd')).toUriString()}">zur
                Aktuellen Woche</a><br><br>
            <a th:with="urlBuilder=${T(org.springframework.web.servlet.support.ServletUriComponentsBuilder).fromCurrentRequest()}"
                th:href="${urlBuilder.replaceQueryParam('monday', lastMonday).toUriString()}">&lt; vorherige Woche</a> |
            <a th:with="urlBuilder=${T(org.springframework.web.servlet.support.ServletUriComponentsBuilder).fromCurrentRequest()}"
                th:href="${urlBuilder.replaceQueryParam('monday', nextMonday).toUriString()}">nächste Woche &gt;</a>
            <br><br>
            <!-- for test purpose -->
            <!-- [[${workloadValueList[0]}]]<br><br>
            [[${workloadValueList[1]}]]<br><br>
            [[${workloadValueList[2]}]]<br><br>
            [[${workloadValueList[3]}]]<br><br>
            [[${workloadValueList[4]}]]<br><br>
            [[${workloadValueList[5]}]]<br><br>
            [[${workloadValueList[6]}]]<br><br> -->

            <canvas id="workloadDiagram">
                Your browser does not support the HTML5 canvas tag.
            </canvas>
            <div
                style="width: 100%; height: 0.5em; background-color: var(--green); padding:0; margin:0; float: left; clear:none;">
            </div>
            <div id="day-buttons">
                <div class="day-button">Mo, [[${#temporals.format(monday, 'dd.MM.')}]]</div>
                <div class="day-button">Di, [[${#temporals.format(monday.plusDays(1), 'dd.MM.')}]]</div>
                <div class="day-button">Mi, [[${#temporals.format(monday.plusDays(2), 'dd.MM.')}]]</div>
                <div class="day-button">Do, [[${#temporals.format(monday.plusDays(3), 'dd.MM.')}]]</div>
                <div class="day-button">Fr, [[${#temporals.format(monday.plusDays(4), 'dd.MM.')}]]</div>
                <div class="day-button">Sa, [[${#temporals.format(monday.plusDays(5), 'dd.MM.')}]]</div>
                <div class="day-button">So, [[${#temporals.format(monday.plusDays(6), 'dd.MM.')}]]</div>
            </div>

            <!-- show examBar here -->
            <h2> Dies ist dein Testbar</h2>
            <div id="stack100"></div>


            <!-- exam overview table here-->
            <h2>Meine Prüfungen diese Woche</h2>
            <span style="font-size:1.5em; font-weight:bold;" th:if="${examsThisWeek.size == 0}">keine Prüfungen -
                yay!</span>
            <table th:unless="${examsThisWeek.size == 0}">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Datum</th>
                        <th>Fach</th>
                        <th>Faktor</th>
                        <th>Pruefungstyp</th>
                        <th>Aufwand</th>
                        <th>Vorbereitungsintervall / Startdatum</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="exam : ${examsThisWeek}">
                        <td th:text="${exam.name}"></td>
                        <td th:text="${#temporals.format(exam.dueDate, 'dd.MM.yyyy')}"></td>
                        <td th:text="${exam.course.subject} + ' (' + ${exam.course} + ')'"></td>
                        <td th:text="${exam.countingFactor}"></td>
                        <td th:text="${exam.examType.getName()}"></td>
                        <td
                            th:text="${exam.workloadMinutesTotal} == 0 ? ${exam.examType.timeValue}+'h' : ${exam.workloadMinutesTotal}+'min'">
                        </td>
                        <td
                            th:text="${exam.getAvailableDaysTotal} + ' Tage / '+${#temporals.format(exam.getRealStartDate, 'dd.MM.yyyy')}">
                        </td>
                    </tr>
                </tbody>
            </table>





            <h2>Meine Prüfungen nächste Woche</h2>
            <span style="font-size:1.5em; font-weight:bold;" th:if="${examsNextWeek.size == 0}">keine Prüfungen -
                yay!</span>
            <table th:unless="${examsNextWeek.size == 0}">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Datum</th>
                        <th>Fach</th>
                        <th>Faktor</th>
                        <th>Pruefungstyp</th>
                        <th>Aufwand</th>
                        <th>Vorbereitungsintervall / Startdatum</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="exam : ${examsNextWeek}">
                        <td th:text="${exam.name}"></td>
                        <td th:text="${#temporals.format(exam.dueDate, 'dd.MM.yyyy')}"></td>
                        <td th:text="${exam.course.subject} + ' (' + ${exam.course} + ')'"></td>
                        <td th:text="${exam.countingFactor}"></td>
                        <td th:text="${exam.examType.getName()}"></td>
                        <td
                            th:text="${exam.workloadMinutesTotal} == 0 ? ${exam.examType.timeValue}+'h' : ${exam.workloadMinutesTotal}+'min'">
                        </td>
                        <td
                            th:text="${exam.getAvailableDaysTotal} + ' Tage / '+${#temporals.format(exam.getRealStartDate, 'dd.MM.yyyy')}">
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Load React. The first two tags load React. A one third one will load your component code. -->
            <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
            <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
            <script th:inline="javascript">

                //workloadView
                var diagram = document.getElementById("workloadDiagram");
                var width = document.getElementById("content-wrapper").offsetWidth - 5;
                var barWidth = width / 7;
                var height = Math.floor(width / 3);
                diagram.width = width;
                diagram.height = height;

                //workload values in percent (0.3 for 30%)
                var mon = /*[[${workloadValueList[0]}]]*/ '0';
                var tue = /*[[${workloadValueList[1]}]]*/ '0';
                var wed = /*[[${workloadValueList[2]}]]*/ '0';
                var thu = /*[[${workloadValueList[3]}]]*/ '0';
                var fri = /*[[${workloadValueList[4]}]]*/ '0';
                var sat = /*[[${workloadValueList[5]}]]*/ '0';
                var sun = /*[[${workloadValueList[6]}]]*/ '0';

                var ctx = diagram.getContext("2d");
                var grd = ctx.createLinearGradient(0, height, 0, 0);

                var style = getComputedStyle(document.body)
                grd.addColorStop(0, style.getPropertyValue('--green'));
                grd.addColorStop(0.5, style.getPropertyValue('--orange'));
                grd.addColorStop(1, "red");

                ctx.fillStyle = grd;
                ctx.globalAlpha = 1;
                ctx.fillRect(0, height - mon * height, barWidth, height);
                ctx.fillRect(barWidth - 1, height - tue * height, barWidth + 1, height);
                ctx.fillRect(2 * barWidth - 1, height - wed * height, barWidth + 1, height);
                ctx.fillRect(3 * barWidth - 1, height - thu * height, barWidth + 1, height);
                ctx.fillRect(4 * barWidth - 1, height - fri * height, barWidth + 1, height);
                ctx.fillRect(5 * barWidth - 1, height - sat * height, barWidth + 1, height);
                ctx.fillRect(6 * barWidth - 1, height - sun * height, barWidth + 1, height);

                //this is the code for examBarView
                const Bar = ({ data }) => {
                    return /*#__PURE__*/ (
                        React.createElement("div", { className: "BarChart" },
                            data &&
                            data.map(d => {
                                return /*#__PURE__*/ (
                                    React.createElement("div", {
                                        className: "BarData",
                                        style: { background: `${d.color}`, width: `${d.percent}%` }
                                    }, /*#__PURE__*/

                                        React.createElement("p", { className: "PercentText" }, d.percent + "%")));
                            })));
                };

                const stack100 = () => {
                //assumed max value for exams per week: 6 (counting factor)
                const data = [{ color: style.getPropertyValue('--lightRed'), percent: Math.round(((6-[[${xFactor}]])/6)*100)}, { color: style.getPropertyValue('--green'), percent: Math.round(([[${xFactor}]]/6)*100)}];
                return /*#__PURE__*/ (
                React.createElement("div", { className: "stack100" }, /*#__PURE__*/
                React.createElement(Bar, { data: data })));

                };

                ReactDOM.render( /*#__PURE__*/ React.createElement(stack100, null), document.querySelector("#stack100"));
            </script>


        </div>

        <!-- footer with navigation (only mobile) -->
        <div th:include="fragments/footer :: footer"></div>
</body>

</html>